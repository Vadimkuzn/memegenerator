<% if current_user %>

<H1>Current User info:</H1>
<br>

<% def get_shortcode(uri) %>
<%  arr = uri.scan(/\w+/) %>
<%  arr[-1] %>
<% end %>

<% api = CoubApi::Client.new(current_user.auth_token) %>
<% muser = api.get('users/me') %>

<table align=center, border=1, border-spacing=1>

 <tr>
  <th>current_user.name</th>
  <th><%= current_user.name %></th>
 </tr>
 <tr>
  <th>current_user.id</th>
  <th><%= current_user.id %></th>
 </tr>
 <tr>
  <th>current_user.provider</th>
  <th><%= current_user.provider %></th>
 </tr>
 <tr>
  <th>current_user.uid</th>
  <th><%= current_user.uid %></th>
 </tr>
 <tr>
  <th>current_user.auth_token</th>
  <th><%= current_user.auth_token %></th>
 </tr>
 <tr>
  <th>current_user.created_at</th>
  <th><%= current_user.created_at %></th>
 </tr>
 <tr>
  <th>current_user.updated_at</th>
  <th><%= current_user.updated_at %></th>
 </tr>

</table>


<br>
<br>

<table align=center, border=1, border-spacing=1>

 <tr>
  <th>id</th>
  <th><%= muser["id"] %></th>
 </tr>
 <tr>
  <th>permalink</th>
  <th><%= muser["permalink"] %></th>
 </tr>
 <tr>
  <th>current_channel</th>
   <% current_channel = muser["current_channel"] %>
   <% current_channel_id = current_channel["id"] %>
  <th><%= current_channel_id %></th>
 </tr>
 <tr>
  <th>likes by channel</th>
  <% r = api.get("likes/by_channel", channel_id: current_channel_id) %>
  <th><%= render plain: r.inspect %></th>
 </tr>
</table>

<br>

<% url = "https://coub.com/view/b9t15" %>

<% shortcode = get_shortcode(url) %>
<% cbinfo = api.get("coubs/#{shortcode}") %>

<H1>URL to check:</H1>
<table align=center, border=1, border-spacing=1>
 <tr>
  <th>URL</th>
  <th><%= p url %></th>
 </tr>
 <tr>
  <th>Shortcode</th>
  <th><%= p shortcode %></th>
 </tr>
 <tr>
  <th>Coub ID from Shortcode</th>
  <th><%= p cbinfo["id"] %></th>
 </tr>
</table>


<H1><p>Coub Likes List:</p></H1>
<% ar = api.get("action_subjects_data/coub_likes_list", id: cbinfo["id"], page: 1) %>

<table align=center, border=1, border-spacing=1>
 <tr>
  <th>Title</th>
  <th>ID</th>
 </tr>

 <% ar["channels"].each do |ch| %>
  <tr>
   <td><%= ch["title"] %></td>
   <td><%= ch["id"] %></td>
  </tr>
 <% end %>
</table>

</b>


  <p><%= link_to "Log out", logout_path, method: :delete %></p>

  <%= form_for Coub.new, url: {action: "create"} do |f| %>
    <%= f.text_field :text1, placeholder: "To me", maxlength: 30, size: 50 %><br />
    <%= f.text_field :text2, placeholder: "Your Coub API", maxlength: 30, size: 50 %><br />
    <%= f.text_field :text3, placeholder: "Is a piece of shit", maxlength: 30, size: 50 %><br />
    <%= f.select :visibility_type, options_for_select(["public", "friends", "unlisted", "private"]) %><br />
    <%= f.text_field :tags, placeholder: "first tag, second tag" %><br />
    <%= f.submit "Create Coub" %>
  <% end %>

<% else %>
 <p>Please <a href="/auth/coub">log in via Coub</a>.</p>
<% end %>
